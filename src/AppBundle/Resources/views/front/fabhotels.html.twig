{% extends 'base.html.twig' %}

{% block title %}FabHotels: Indiaâ€™s Best Budget Hotels{% endblock %}

{% block stylesheets %}
    {% stylesheets 'bundles/app/css/front.css' filter="cssrewrite" output="assets/front/fabhotels.css" %}
        <link rel="stylesheet" type="text/css" href="{{ asset_url }}">
    {% endstylesheets %}
{% endblock %}

{% block body %}
<div class="search-bar">
    <label>Search Hotels</label>
    <input type="text" id="search-box" placeholder="City, locality, landmark">
    <span class="search-box-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 96 96">
            <path d="M48 18.8c-11.3 0-20.4 9.1-20.4 20.4 0 15.4 20.4 38 20.4 38s20.4-22.6 20.4-37.9c0-11.3-9.1-20.5-20.4-20.5zm0 27.7c-4 0-7.3-3.3-7.3-7.3S44 32 48 32s7.3 3.3 7.3 7.3-3.3 7.2-7.3 7.2z" fill="#1C2260" />
        </svg>
    </span>
</div>
{% endblock %}
{% block javascripts %}
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" src="//maps.googleapis.com/maps/api/js?sensor=false&libraries=places&language=en&key=AIzaSyBZsVo99RCtDjUsjWhYV5MKPOlREj8ZxVo"></script>
    <script>
        var search_url = "{{ path('app_search_property') }}";
        var autocomplete = new google.maps.places.Autocomplete(document.getElementById('search-box'));

        $(function () {
            $('#search-box').on('keyup', function (e) {
                $('.pac-container').removeClass('pac-logo');
                let search_box = $(this);
                if(/^[0-9a-zA-Z\s\-\'\/,]$/.test(e.key) || e.key == 'Backspace') {
                    let search_query = search_box.val().trim();
                    $('.pac-container').find('.pac-hotels').remove();
                    if(search_query.length > 0) {
                        $.ajax({
                            url: search_url,
                            data: {
                                keywords: search_query
                            },
                            dataType: 'json',
                            success: function(response) {
                                if(!$.isEmptyObject(response.data)) {
                                    let html = '<div class="pac-hotels">';
                                    $.each(response.data, function(index, property) {
                                        html += '<div class="pac-item"><span class="pac-icon icon-hotel"></span><span class="pac-item-query">'+ property.name.concat(' ', property.locality).replace(new RegExp('(' + response.keywords + ')', 'ig'), '<span class="pac-matched">$1</span>') + '</span><span> ' + property.city.concat(', ', property.state, ', ', ', ', property.country) + '</span></div>';
                                    })
                                    html += "</div>";
                                    $('.pac-container').find('.pac-hotels').remove();
                                    $('.pac-container').append(html);
                                }
                            }
                        })
                    }
                }
                else {
                    e.preventDefault();
                }
            })
        })
    </script>
{% endblock %}